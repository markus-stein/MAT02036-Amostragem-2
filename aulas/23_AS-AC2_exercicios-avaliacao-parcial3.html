<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>MAT02036 - Amostragem 2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Markus Stein" />
    <script src="libs/header-attrs-2.18/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, title-slide

.title[
# MAT02036 - Amostragem 2
]
.subtitle[
## Aula 23 - <strong>AS</strong> e <strong>AC2S</strong> - Avalia√ß√£o Parcial 3
]
.author[
### Markus Stein
]
.institute[
### Departamento de Estat√≠stica, IME/UFRGS
]
.date[
### 2022/2
]

---




<div>
<style type="text/css">.xaringan-extra-logo {
width: 110px;
height: 128px;
z-index: 0;
background-image: url(C:/Users/User/Documents/MAT02036-Amostragem-2/img/logo_dest.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:1em;right:1em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>

### *Housekeeping*

* Aproveitem o momento presencial para tirar d√∫vidas

* Se estiv√©ssemos no ensino remoto ou √† dist√¢ncia

  + voc√™s poderiam estar somente ouvindo, sem intera√ß√£o
  
  + ou assistindo v√≠deos e material em outro momento
  
* Depois das aulas, rever material da aula passada

  + fazer exerc√≠cios
  
  + se preparar para a pr√≥xima aula

---

## Aula passada üíΩ
### Efici√™ncia e Coef. de Correla√ß√£o Intraclasse na AC2S

---

## Aula passada üìÄ
### Tamanho de amostra na AC2S

---

class: inverse, middle, center

# Exerc√≠cios de avalia√ß√£o AS e  AC2S

---

## Avalia√ß√£o Parcial 3
### Quest√£o 1

Comente vantagens e desvantagens do plano amostral de um estudo que, para estimar o n√∫mero m√©dio de usu√°rios de certa linha de √¥nibus por viagem, tenha usado uma amostra sistem√°tica de todas as primeiras sa√≠das do dia desta linha por um m√™s. 

a. √â poss√≠vel definir este plano como uma **AC1**? De que forma?

b. Compare com um plano **AES** 

---

## Avalia√ß√£o Parcial 3
### Quest√£o 2

Seja o exemplo da frota de avi√µes do pa√≠s com 10 cias. a√©reas. Num primeiro est√°gio, 4 cias. foram sorteadas por **AASs**. Num segundo est√°gio, `\(n_i\)` avi√µes foram sorteados tamb√©m por **AASs** de cada cia. Os resultados foram:

Cia `\((i)\)` | `\(N_i\)` | `\(n_i\)` | `\(t_i = \sum_{j \in s_i} y_{ij}\)` | `\(S^2_i\)` | `\(\overline y_i\)` | `\(\widehat T_i\)`
--|--|--|--|--|--|--
3 | 15 | 5 | 25 | 1 | 5 | 75
6 | 15 | 5 | 30 | 1,5 | 6 | 90
8 | 10 | 4 | 28 | 2,5 | 7 | 70
9 | 10 | 4 | 16 | 0,625 | 4 | 40
Total | 50 | 18 | 99 | - | - | 275

a. Defina a vari√°vel de interesse e um par√¢metro de interesse.  
b. Escolha um estimador. √â n√£o viesado?  
c. Estime o par√¢metro.  
d. Coeficiente de correla√ß√£o intraclasse.(?)

---

class: inverse, middle, center

# Solu√ß√£o

---

## Avalia√ß√£o Parcial 3
### Quest√£o 1 - solu√ß√£o

Um exemplo de fluxo di√°rio de passageiros

&lt;img src="img/bus_passanger_flow_COVID_beijing.png" width="100%" height="100%" style="display: block; margin: auto;" /&gt;
.center[
#### Fonte: do artigo *An Improved STL-LSTM Model for Daily Bus Passenger Flow Prediction during the COVID-19 Pandemic* (https://www.mdpi.com/1258480).
]

---

## Avalia√ß√£o Parcial 3
### Quest√£o 1 - solu√ß√£o

Poss√≠veis vantagens: m√©todo simples de ser implementado

* para entrevistador pois ter√° definido o mesmo hor√°rio para seu trabalho?

* observar o dia todo seria de maior custo?

Desvantagens:

* Nos slides Aula 20, pg. 19, "Para popula√ß√µes peri√≥dicas, amostragem sistem√°tica simples com
intervalo de sele√ß√£o em sincronia com o per√≠odo √© um desastre (@Cochran1977, p√°gina 218)."

  + Nesse caso, observando o mesmo per√≠odo todo o dia esperamos estar na situa√ß√£o em que o intervalo de observa√ß√£o `\(K\)` seja m√∫ltiplo do per√≠odo do (ciclo de) fluxo de passageiros.
  
  + Cochran sugere que seja utilizado um m√∫ltiplo √≠mpar de metade do per√≠odo. 

---

## Avalia√ß√£o Parcial 3
### Quest√£o 1 - solu√ß√£o

* Na apostila, pg. 40, menciona Bolfarine e Bussab (2005), que 

  + indicam que na maioria das situa√ß√µes para estimar a vari√¢ncia do estimador da m√©dia sob **AS** pode ser usado o estimador da vari√¢ncia supondo **AASs**: 
  
  + "Esse estimador √© adequado quando a **AS** √© aproximadamente equivalente √† **AAS**. Vale ressaltar que, quando as popula√ß√µes apresentam periodocididade ou tend√™ncias, as duas amostragens podem ter resultados bastante distintos. Por exemplo, vendas di√°rias de um certo produto no supermercado podem apresentar periodicididade."

---

## Avalia√ß√£o Parcial 3
### Quest√£o 1 - solu√ß√£o

a) No caso de uma **AC1S**, se considerarmnos dias como conglomerados (faz sentido?) selecionamos `\(m\)` dias dos `\(M\)` dias do m√™s, 

  + Ter√≠amos o mesmo tamanho da amostra??? 

  + Esperar√≠amos diferen√ßas de turno durante o dia e dias √∫teis e n√£o √∫teis estarem presentes na amostra?

b) No caso de uma **AES**, poder√≠amos definir `\(H\)` estratos como turnos, ou per√≠odos do dia, e selecionar√≠amos `\(s_h\)` dias dentro do m√™s?

  + Esperar√≠amos diferen√ßas de turno durante o dia e dias √∫teis e n√£o √∫teis estarem presentes na amostra?

---

## Avalia√ß√£o Parcial 3
### Quest√£o 2 - solu√ß√£o


```r
## dados do problema - slides Aula 13
i &lt;- 1:10                                       # indice dos estratos
Ni &lt;- c(10, 15, 15, 15, 10, 15, 15, 10, 10, 15) # tamanhos dos estratos
Ti &lt;- c(40, 75, 75, 60, 60, 90, 75, 70, 40, 90) # totais dos estratos
N &lt;- sum(Ni)                 # tamanho da populacao
M &lt;- length(Ni)              # no. estratos na populacao 
## dados adicionais questao 2 - slides Aula 23
m &lt;- 4                       # no. estratos na amostra   
a &lt;- c(3, 6, 8, 9)           # indices dos conglomerados selecionados
ni &lt;- c(5, 5, 4, 4)          # tamanhos de amostra em cada cluster
ti &lt;- c(25, 30, 28, 16)      # totais das amostras em cada cluster
S2i &lt;- c(1, 1.5, 2.5, 0.625)
```

a) A vari√°vel de interesse, (observada em cada uma das unidades elementares)

`\(y\)`: dist√¢ncia (em milhas) percorrida pelas a√©ronaves das companhias a√©reas de um pa√≠s. 

---

## Avalia√ß√£o Parcial 3
### Quest√£o 2 - solu√ß√£o

* Poss√≠veis par√¢metros s√£o: 
  
  + `\(T\)` o total de milhas percorridas por todas as aeronaves do pa√≠s;
  
  + `\(\overline Y\)` a m√©dia de milhas percorridas por aeronave.

b) Escolha do estimador e justificativa  

* Para o total temos 
`$$\widehat T^{HT}_{AC2S} = \frac {M} {m} \sum_{i \in a} \widehat T_i \: \: \: \: \: \text{ou} \: \: \: \: \: \widehat T^R_{AC2S} = N \frac{ \sum_{i \in a} \widehat T_i}{ \sum_{i \in a} N_i},$$`
em que `\(\widehat T_i = \frac {N_i} {n_i} \sum_{j \in s_i} y_{ij}\)`

* Para a m√©dia  
`$$\overline y^{HT}_{AC1S} = \frac {\widehat T_{AC1S/HT}}{N} \: \: \: \: \: \text{ou} \: \: \: \: \: \overline y^R_{AC2S} = \frac {\widehat T^R_{AC1S}}{N}.$$`


---

## Avalia√ß√£o Parcial 3
### Quest√£o 2 - solu√ß√£o

O esimador escolhido √© viesado ou n√£o? Justificar.

`$$E \left( \widehat T_{AC2S} \right) =  E_1 \left( E_2 \left( \widehat T_{AC2S} \right) \right) \: \: \: \text{ou} \: \: \: E \left( \overline y_{AC2S} \right) =  E_1 \left( E_2 \left( \overline y_{AC2S} \right) \right).$$`

c) Estimativa do total, c√°lculos e interpreta√ß√£o.


```r
## estimativas pontuais do total
Ti_hat &lt;- (Ni[a] / ni) * ti
T_hat_HT &lt;- (M / m) * sum(Ti_hat)
n &lt;- sum(ni)
T_hat_R &lt;- (N / n) * sum(Ti_hat)
```

  + `\(\widehat T^{HT}_{AC2S} = \frac{10}{4} \left( \frac{15}{5}25 + \frac{15}{5}30 + \frac{10}{4}28 + \frac{10}{4}16 \right) = 687.5\)`. 
  + `\(\widehat T^{HT}_{AC2S} = \frac{130}{18} \left( \frac{15}{5}25 + \frac{15}{5}30 + \frac{10}{4}28 + \frac{10}{4}16 \right) = 1986.1111111\)`
  
Estimamos que a dist√¢ncia total percorrida por todas as aeronaves do pa√≠s seja aproximadamente 687.5 (ou 1986.11) milhas.
  

---

## Avalia√ß√£o Parcial 3
### Quest√£o 2 - solu√ß√£o

* para a m√©dia


```r
## estimativas pontuais da media
ybarra_HT &lt;- T_hat_HT / N
ybarra_R &lt;- T_hat_R / N
```

  + `\(\overline y^{HT}_{AC2S} = \frac{687.5}{130} = 5.29.\)` 
  + `\(\overline y^R_{AC2S} = \frac{1986.1111111}{130} = 15.28.\)` 

Estimamos que a dist√¢ncia m√©dia percorrida por cada aeronave do pa√≠s seja cerca de 5.29 (15.28) milhas.

---

## Avalia√ß√£o Parcial 3
### Quest√£o 2 - solu√ß√£o

d) Coeficiente de correla√ß√£o intraclasse.(slides Aula 22 e Apostila pg. 50)

`$$EPA(AC2S) \approx 1 + \rho_{int} (\overline n - 1),$$`

em que `\(EPA(AC2S) = \frac{Var_{AC2S} (\overline y)}{Var_{AASc} (\overline y)}\)`.
 
* Um estimador n√£o viciado da vari√¢ncia do estimador HT 

`$$\widehat Var_{AC2S} \left( \overline y_{AC2S} \right) = \frac{1}{N^2} \widehat Var_{AC2S} \left( \widehat T_{AC2S} \right)$$`

onde: 

`\(\widehat Var_{AC2S} \left( \widehat T_{AC2S} \right) = M^2 \left( \frac {1} {m} - \frac {1} {M} \right) \frac {1} {m-1} \sum_{i \in a} \left( \widehat T_i - \overline y_C \right)^2 + \frac {M} {m} \sum_{i \in a} N_i^2 \left( \frac {1} {n_i} - \frac {1} {N_i} \right) \widehat S_i^2\)`  

`\(\overline y_C = \frac {1} {m} \sum_{i \in a} \widehat T_i\)` estima a m√©dia por conglomerado `\(\overline {Y_C}\)`; e

`\(\widehat S_i^2 = \frac {1} {n_i-1} \sum_{j \in s_i} \left( y_{ij} - \overline y_i \right)^2\)` estima a vari√¢ncia dentro da UPA `\(i\)`.

---

## Avalia√ß√£o Parcial 3
### Quest√£o 2 - solu√ß√£o


```r
## variancias estimadas dos estimadores da media
ybarraC &lt;- T_hat_HT / m
# s2i_hat &lt;- sum() 
(var_ybarra_HT &lt;- M^2 * (1/m - 1/M) * (1/(m-1)) * sum((Ti_hat - ybarraC)^2) +
                 (M/m) * sum( Ni[a]^2 * (1/ni - 1/ Ni[a]) * S2i))
```

```
## [1] 219593.8
```

* Adaptando da Aula 12  para na **AC2S** com **AASs** de conglomerados nos dois est√°gios,

`$$\widehat S_y^2 = \frac {(\overline N - 1) M \widehat S_{dc}^2 + \overline N (M-1) \overline \widehat S_{ec}^2} {M \overline N - 1},$$`
onde `\(\overline \widehat S_{ec}^2 = \frac {\widehat S_{ec}^2} {\overline N}\)` e:

* a medida da **vari√¢ncia entre** os totais dos conglomerados

`$$\widehat S_{ec}^2 = \frac {1} {m-1} \sum_{i \in a} \left( \widehat T_i - \overline y_C \right)^2;$$`

* a medida da vari√¢ncia *dentro* dos conglomerados, dada por: 

`$$\widehat S_{dc}^2 = \frac {1} {m - 1} \sum_{i \in a} S_i^2.$$` 

ent√£o

`$$\rho_{int} = \frac{(M-1) \overline N S^2_{ec} - (M \overline N - 1) S^2}{(M \overline N - 1)(\overline N - 1) S^2},$$` 
em que `\(S_{ec}^2 = \frac {1} {M-1} \sum_{i \in C} \left( T_i - \overline Y_C \right)^2\)`

---

## Para casa üè†

*  Continuar trabalho e apresenta√ß√£o final.

&lt;!-- * Continuar exemplos. --&gt;

&lt;!-- Continuar o Exerc√≠cio. --&gt;

&lt;!-- * Mostrar tamanho de amostra `\(n\)` para AASc dentro dos estratos. --&gt;

&lt;!-- * Continuar exerc√≠cios do livro 'Amostragem: Teoria e Pr√°tica Usando R'    https://amostragemcomr.github.io/livro/estrat.html#exerc11 --&gt;

&lt;!-- * Ler o cap√≠tulo 4 da apostila da Profa. Vanessa. --&gt;

&lt;!-- * Ler se√ß√£o 12.10 do livro 'Amostragem: Teoria e Pr√°tica Usando R'. --&gt;

&lt;!-- * Rever os slides. --&gt;

&lt;!-- * Ler BOlfarine e Bussab...da se√ß√£o 11.3 do livro 'Amostragem: Teoria e Pr√°tica Usando R'. --&gt;

&lt;!-- * Prepara√ß√£o para avalia√ß√£o parcial 2 --&gt;

## Pr√≥xima aula üìä

* Acompanhar o material no moodle.

Amostragem Conglomerada com probabilidades em 2 est√°gios

  + Efeito de planejamento e tamanho de amostra.

  + Laborat√≥rio de &lt;i class="fa-duotone fa-people-group"&gt;&lt;/i&gt;<svg aria-hidden="true" role="img" viewBox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:steelblue;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg>

---

## Muito obrigado!

&lt;img src="img/image_basu_elephant.jpg" width="20%" height="20%" style="display: block; margin: auto;" /&gt;
.center[
#### Fonte: imagem do livro *Combined Survey Sampling Inference: Weighing of Basu's Elephants*.
]


---

## Refer√™ncias

&lt;!-- Slides baseados no Cap√≠tulo 11 do livro --&gt;

* [Amostragem: Teoria e Pr√°tica Usando o R](https://amostragemcomr.github.io/livro/index.html)

* **Elementos de Amostragem**, Bolfarine e Bussab.

&lt;!-- Cita√ß√µes do Cap√≠tulo --&gt;

&lt;!-- * Neyman(1934) --&gt;

* Cochran(1977)


&lt;!-- * refazer calculos para amostagem aleatoria simples com reposicao --&gt;
&lt;!-- * alocacao... ou lab R comparando aloca√ß√£o proporcional e igual tamanho --&gt;

&lt;!-- listas de exercicios... --&gt;
&lt;!-- dois aspectos da disciplina... ter flexibilidade com teoria... exercitar os conceitos com exercicios teoricos e praticos --&gt;

&lt;!-- falar dos pesos na AES --&gt;

&lt;!-- valor z_alpha/2 significa z ou t --&gt;

&lt;!-- quem tiver interesse em conferir as f√≥rmulas... mostra as conttas, gosta dessa pparte...posso contabilizar ponto extra... tem q ser o primeira... --&gt;
&lt;!-- o mesmo pode valer para os c√≥digos e texto... --&gt;
&lt;!-- fazer o formul√°rio --&gt;
&lt;!-- resumo de formulas --&gt;

---

## Resumo da nota√ß√£o

---

## Trabalho

.center[
#### T√≥picos em 
#### `Amostragem com Probabilidades Vari√°veis` 
#### e 
####`Amostragens Complexas`
]

* Escolher um tema dentre os t√≥picos que encerram o conjunto de disciplinas de Amostragem.

* Materiais dispon√≠veis:
  + minicurso Sinape
  + minicurso Thomas
  + cap√≠tulos das nossas refe√™ncias

* Apresentar:
  + problema
  + delineamento e estrat√©gia
  + 10 slides? m√°ximo  
  + 15 min apresentacao + 5 min perguntas. presencial ou video

&lt;!-- * falar com Ju --&gt;

&lt;!-- * Falar do meu problema  --&gt;
&lt;!-- 	+ ... --&gt;

&lt;!-- chamar rodrigo e ju e marcia, para as apresentacoes??? tem canecas do datathon --&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
